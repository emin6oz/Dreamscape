import React, { useEffect, useRef } from "react";
import "./statisticsScreen.scss";

import SleepStagesChart from "../components/sleepstageschart";

const getWeekDates = () => {
  
  const today = new Date();
  const week = [];
  const start = new Date(today);
  start.setDate(today.getDate() - 6);
  for (let i = 0; i < 7; i++) {
    const date = new Date(start);
    date.setDate(start.getDate() + i);
    week.push({
      day: date.toLocaleDateString("en-US", { weekday: "short" }),
      date: date.getDate(),
      isToday: date.toDateString() === today.toDateString(),
      past: date <= today,
    });
  }
  return week;
};

const StatisticsScreen = () => {
  const scrollRef = useRef(null);
  const weekDates = getWeekDates();

  useEffect(() => {
    const todayIndex = weekDates.findIndex((d) => d.isToday);
    if (scrollRef.current) {
      const child = scrollRef.current.children[todayIndex];
      if (child) {
        child.scrollIntoView({ behavior: "smooth", inline: "center" });
      }
    }
  }, [weekDates]);

  return (
    <div className="statistics-screen">
      <h1 className="title">Statistics</h1>

      <div className="date-row" ref={scrollRef}>
        {weekDates.map((d, i) => (
          <div
            key={i}
            className={`date-item ${d.isToday ? "active" : ""} ${
              !d.past ? "disabled" : ""
            }`}
          >
            <span className="day">{d.day}</span>
            <span className="date">{d.date}</span>
          </div>
        ))}
      </div>

      <h2 className="section-title">Sleep stages</h2>
      <SleepStagesChart />

      <div className="sleep-info">
        
        <div className="info-block">
          <span role="img" aria-label="moon">
            <div className="label">Asleep</div>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="17"
              height="18"
              viewBox="0 0 17 18"
              fill="none"
            >
              <path
                d="M8.80046 0C7.20702 0.000299398 5.64356 0.442865 4.27683 1.28049C2.91011 2.11811 1.79139 3.31937 1.04002 4.75612C0.288652 6.19288 -0.0671886 7.81124 0.0104587 9.43857C0.0881061 11.0659 0.596328 12.6411 1.48091 13.9963C2.3655 15.3514 3.59326 16.4356 5.03324 17.1333C6.47322 17.8309 8.07139 18.1157 9.65729 17.9574C11.2432 17.7991 12.7573 17.2036 14.0381 16.2344C15.319 15.2652 16.3185 13.9587 16.9301 12.4542C17.2302 11.7162 16.5111 10.9746 15.7875 11.2752C14.5475 11.7888 13.1706 11.8418 11.8963 11.425C10.622 11.0082 9.53082 10.1479 8.81255 8.99372C8.09429 7.83955 7.79432 6.4645 7.96483 5.10764C8.13533 3.75077 8.76551 2.49792 9.7458 1.5669L9.81357 1.4949C10.2986 0.9279 9.91304 0.00720001 9.14638 0.00720001H8.91224L8.85239 0.00179998L8.80046 0Z"
                fill="#F4F4F4"
              />
            </svg>
          </span>

          <div className="value">8h</div>
        </div>
        <div className="info-block">
          <span role="img" aria-label="bed">
            <div className="label">In bed</div>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="25"
              height="25"
              viewBox="0 0 25 25"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M11.4002 3.38544H13.6002C15.5147 3.38544 17.0314 3.38544 18.2179 3.54481C19.4387 3.7094 20.4272 4.05523 21.2075 4.8344C21.9866 5.6146 22.3325 6.60315 22.497 7.82398C22.6543 8.9969 22.6564 10.4906 22.6564 12.374C23.0147 12.6688 23.2991 13.0511 23.4793 13.4875C23.6054 13.7896 23.6543 14.1021 23.6772 14.4323C23.6981 14.749 23.6981 15.1354 23.6981 15.599V15.6511C23.6981 16.1146 23.6981 16.5011 23.6772 16.8177C23.6642 17.1415 23.5973 17.4608 23.4793 17.7625C23.3355 18.1102 23.1246 18.4261 22.8586 18.6922C22.5927 18.9584 22.2769 19.1695 21.9293 19.3136C21.6272 19.4386 21.3147 19.4875 20.9845 19.5094C20.8476 19.5187 20.7104 19.5246 20.5731 19.5271V20.8334C20.5731 21.0406 20.4908 21.2393 20.3443 21.3858C20.1977 21.5323 19.999 21.6146 19.7918 21.6146C19.5846 21.6146 19.3859 21.5323 19.2394 21.3858C19.0929 21.2393 19.0106 21.0406 19.0106 20.8334V19.5313H5.98975V20.8334C5.98975 21.0406 5.90744 21.2393 5.76092 21.3858C5.61441 21.5323 5.4157 21.6146 5.2085 21.6146C5.0013 21.6146 4.80258 21.5323 4.65607 21.3858C4.50956 21.2393 4.42725 21.0406 4.42725 20.8334V19.5261C4.28998 19.5239 4.15278 19.5183 4.01579 19.5094C3.69217 19.497 3.37287 19.4308 3.071 19.3136C2.72324 19.1696 2.40727 18.9585 2.14113 18.6924C1.875 18.4262 1.66392 18.1103 1.51995 17.7625C1.39495 17.4604 1.346 17.1479 1.32412 16.8177C1.30225 16.5011 1.30225 16.1146 1.30225 15.6511V15.599C1.30225 15.1354 1.30225 14.749 1.32308 14.4323C1.346 14.1011 1.396 13.7896 1.521 13.4875C1.69997 13.0543 1.98254 12.6715 2.34391 12.3729C2.34391 10.4917 2.346 8.9969 2.50329 7.82398C2.66787 6.60315 3.0137 5.6146 3.79287 4.8344C4.57308 4.05523 5.56162 3.7094 6.78245 3.54481C7.96995 3.38544 9.48558 3.38544 11.4002 3.38544ZM3.90641 11.749L4.01579 11.7406C4.27725 11.7229 4.58766 11.7198 4.94808 11.7198V10.8834C4.94808 9.94794 4.94808 9.16669 5.03141 8.54794C5.11891 7.89377 5.31266 7.30315 5.78662 6.82919C6.26162 6.35419 6.85225 6.16044 7.50537 6.07294C8.12516 5.9896 8.90641 5.9896 9.84183 5.9896H15.1585C16.095 5.9896 16.8752 5.9896 17.4939 6.07294C18.1481 6.16044 18.7387 6.35419 19.2127 6.82815C19.6877 7.30314 19.8814 7.89377 19.9689 8.5469C20.0522 9.16669 20.0522 9.94794 20.0522 10.8834V11.7188C20.3997 11.7164 20.7472 11.7265 21.0939 11.749C21.0908 10.15 21.0731 8.96252 20.9481 8.03231C20.8075 6.9844 20.5429 6.38023 20.1022 5.93856C19.6616 5.49898 19.0575 5.2344 18.0095 5.09377C16.9397 4.95002 15.5283 4.94794 13.5418 4.94794H11.4585C9.47204 4.94794 8.06162 4.95002 6.98975 5.09377C5.94287 5.2344 5.33871 5.49898 4.89808 5.9396C4.45745 6.38023 4.19287 6.9844 4.05225 8.03127C3.92725 8.96148 3.90954 10.149 3.90641 11.7479M18.4897 11.7177V10.9365C18.4897 9.93231 18.4877 9.25731 18.42 8.75419C18.3554 8.27398 18.2439 8.06773 18.1075 7.93231C17.971 7.7969 17.7668 7.68544 17.2866 7.61981C16.7835 7.55315 16.1085 7.55106 15.1043 7.55106H13.2814V11.7177H18.4897ZM11.7189 11.7177V7.55106H9.896C8.89183 7.55106 8.21683 7.55315 7.71371 7.62085C7.2335 7.68544 7.02725 7.7969 6.89183 7.93335C6.75641 8.06981 6.64495 8.27398 6.57933 8.75419C6.51266 9.25731 6.51058 9.93231 6.51058 10.9365V11.7177H11.7189ZM4.12204 13.2979C3.871 13.3156 3.74912 13.3459 3.66891 13.3792C3.51079 13.4446 3.36712 13.5406 3.24611 13.6616C3.12511 13.7826 3.02914 13.9263 2.9637 14.0844C2.93037 14.1646 2.90016 14.2865 2.88245 14.5375C2.86475 14.7948 2.86475 15.1281 2.86475 15.624C2.86475 16.1198 2.86475 16.4531 2.88245 16.7104C2.90016 16.9615 2.93037 17.0834 2.9637 17.1636C3.096 17.4834 3.34912 17.7365 3.66891 17.8688C3.74912 17.9021 3.871 17.9323 4.12204 17.95C4.37933 17.9677 4.71266 17.9677 5.2085 17.9677H19.7918C20.2877 17.9677 20.621 17.9677 20.8783 17.95C21.1293 17.9323 21.2512 17.9021 21.3314 17.8688C21.6512 17.7365 21.9043 17.4834 22.0366 17.1636C22.07 17.0834 22.1002 16.9615 22.1179 16.7104C22.1356 16.4531 22.1356 16.1198 22.1356 15.624C22.1356 15.1281 22.1356 14.7948 22.1179 14.5375C22.1002 14.2865 22.07 14.1646 22.0366 14.0844C21.9712 13.9263 21.8752 13.7826 21.7542 13.6616C21.6332 13.5406 21.4895 13.4446 21.3314 13.3792C21.2512 13.3459 21.1293 13.3156 20.8783 13.2979C20.5164 13.2813 20.1541 13.2757 19.7918 13.2813H5.2085C4.71266 13.2813 4.37933 13.2813 4.12204 13.299"
                fill="#F4F4F4"
              />
            </svg>
          </span>

          <div className="value">8h 30min</div>
        </div>
        <div className="info-block">
          <span role="img" aria-label="sound">
            <div className="label">Noise</div>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="19"
              height="21"
              viewBox="0 0 19 21"
              fill="none"
            >
              <path
                d="M9.5 0.125C9.75514 0.125034 10.0014 0.218704 10.1921 0.388245C10.3827 0.557786 10.5045 0.791405 10.5344 1.04479L10.5417 1.16667V17.8333C10.5414 18.0988 10.4397 18.3542 10.2574 18.5473C10.0752 18.7403 9.82609 18.8565 9.56105 18.8721C9.296 18.8876 9.03502 18.8014 8.83142 18.631C8.62783 18.4606 8.49698 18.2189 8.46562 17.9552L8.45833 17.8333V1.16667C8.45833 0.8904 8.56808 0.625447 8.76343 0.430097C8.95878 0.234747 9.22373 0.125 9.5 0.125ZM5.33333 3.25C5.6096 3.25 5.87455 3.35975 6.0699 3.5551C6.26525 3.75045 6.375 4.0154 6.375 4.29167V14.7083C6.375 14.9846 6.26525 15.2496 6.0699 15.4449C5.87455 15.6403 5.6096 15.75 5.33333 15.75C5.05707 15.75 4.79211 15.6403 4.59676 15.4449C4.40141 15.2496 4.29167 14.9846 4.29167 14.7083V4.29167C4.29167 4.0154 4.40141 3.75045 4.59676 3.5551C4.79211 3.35975 5.05707 3.25 5.33333 3.25ZM13.6667 3.25C13.9429 3.25 14.2079 3.35975 14.4032 3.5551C14.5986 3.75045 14.7083 4.0154 14.7083 4.29167V14.7083C14.7083 14.9846 14.5986 15.2496 14.4032 15.4449C14.2079 15.6403 13.9429 15.75 13.6667 15.75C13.3904 15.75 13.1254 15.6403 12.9301 15.4449C12.7347 15.2496 12.625 14.9846 12.625 14.7083V4.29167C12.625 4.0154 12.7347 3.75045 12.9301 3.5551C13.1254 3.35975 13.3904 3.25 13.6667 3.25ZM1.16667 6.375C1.44293 6.375 1.70789 6.48475 1.90324 6.6801C2.09859 6.87545 2.20833 7.1404 2.20833 7.41667V11.5833C2.20833 11.8596 2.09859 12.1246 1.90324 12.3199C1.70789 12.5153 1.44293 12.625 1.16667 12.625C0.890399 12.625 0.625447 12.5153 0.430097 12.3199C0.234747 12.1246 0.125 11.8596 0.125 11.5833V7.41667C0.125 7.1404 0.234747 6.87545 0.430097 6.6801C0.625447 6.48475 0.890399 6.375 1.16667 6.375ZM17.8333 6.375C18.0885 6.37503 18.3347 6.4687 18.5254 6.63825C18.716 6.80779 18.8379 7.04141 18.8677 7.29479L18.875 7.41667V11.5833C18.8747 11.8488 18.773 12.1042 18.5908 12.2973C18.4085 12.4903 18.1594 12.6065 17.8944 12.6221C17.6293 12.6376 17.3684 12.5514 17.1648 12.381C16.9612 12.2106 16.8303 11.9689 16.799 11.7052L16.7917 11.5833V7.41667C16.7917 7.1404 16.9014 6.87545 17.0968 6.6801C17.2921 6.48475 17.5571 6.375 17.8333 6.375Z"
                fill="#F4F4F4"
              />
            </svg>
          </span>

          <div className="value">40dB</div>
        </div>
      </div>

      <h2 className="section-title">Tips</h2>
      <div className="tips">
        <div className="tip">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M6 9.99999C5.99915 8.92087 6.2478 7.85617 6.72652 6.88905C7.20525 5.92193 7.9011 5.07859 8.7597 4.4249C9.6183 3.77122 10.6164 3.32489 11.676 3.12079C12.7357 2.91669 13.8282 2.96034 14.8682 3.24834C15.9081 3.53633 16.8674 4.06087 17.6712 4.78097C18.4749 5.50108 19.1012 6.39725 19.5012 7.39948C19.9013 8.40172 20.0642 9.48287 19.9772 10.5585C19.8903 11.6341 19.5558 12.675 19 13.6C18.4315 14.3581 17.7581 15.0315 17 15.6C16.1137 16.4348 15.4297 17.4608 15 18.6C14.6897 19.1864 14.2535 19.697 13.7228 20.0951C13.192 20.4932 12.5798 20.769 11.93 20.9028C11.2802 21.0366 10.6088 21.025 9.96393 20.869C9.31908 20.7129 8.71673 20.4161 8.2 20"
                stroke="#F4F4F4"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M10.0002 9.99999C9.99421 9.4981 10.1142 9.00272 10.3493 8.55924C10.5843 8.11575 10.9269 7.73832 11.3456 7.46153C11.7643 7.18473 12.2458 7.01741 12.7459 6.97489C13.246 6.93238 13.7488 7.01602 14.2082 7.21817C14.6676 7.42031 15.069 7.73449 15.3755 8.13194C15.6821 8.52939 15.884 8.99739 15.9628 9.49309C16.0416 9.98879 15.9948 10.4963 15.8266 10.9693C15.6584 11.4422 15.3743 11.8653 15.0002 12.2"
                stroke="#F4F4F4"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
          Use ear plugs in not so quiet places for better rest.
        </div>
        <div className="tip">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M18.32 8H5.67L5.23 4H18.77M3 2L5 20.23C5.13 21.23 5.97 22 7 22H17C18 22 18.87 21.23 19 20.23L21 2H3Z"
                fill="#F4F4F4"
              />
            </svg>
          </span>
          Stay hydrated! Drinking water before bed supports temperature
          regulation.
        </div>
        <div className="tip">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M11 17H4C3.20435 17 2.44129 16.6839 1.87868 16.1213C1.31607 15.5587 1 14.7956 1 14V6C1 5.20435 1.31607 4.44129 1.87868 3.87868C2.44129 3.31607 3.20435 3 4 3H20C20.7956 3 21.5587 3.31607 22.1213 3.87868C22.6839 4.44129 23 5.20435 23 6V14C23 14.7956 22.6839 15.5587 22.1213 16.1213C21.5587 16.6839 20.7956 17 20 17H13V19H16C16.2652 19 16.5196 19.1054 16.7071 19.2929C16.8946 19.4804 17 19.7348 17 20C17 20.2652 16.8946 20.5196 16.7071 20.7071C16.5196 20.8946 16.2652 21 16 21H8C7.73478 21 7.48043 20.8946 7.29289 20.7071C7.10536 20.5196 7 20.2652 7 20C7 19.7348 7.10536 19.4804 7.29289 19.2929C7.48043 19.1054 7.73478 19 8 19H11V17ZM4 5H20C20.2652 5 20.5196 5.10536 20.7071 5.29289C20.8946 5.48043 21 5.73478 21 6V14C21 14.2652 20.8946 14.5196 20.7071 14.7071C20.5196 14.8946 20.2652 15 20 15H4C3.73478 15 3.48043 14.8946 3.29289 14.7071C3.10536 14.5196 3 14.2652 3 14V6C3 5.73478 3.10536 5.48043 3.29289 5.29289C3.48043 5.10536 3.73478 5 4 5Z"
                fill="#F4F4F4"
              />
            </svg>
          </span>
          Avoid screens 1–2 hours before bed.
        </div>
        <div className="tip">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M20 4V17C19.9997 17.6368 19.7967 18.2569 19.4206 18.7707C19.0444 19.2844 18.5145 19.6652 17.9076 19.8578C17.3007 20.0505 16.6482 20.045 16.0446 19.8422C15.441 19.6394 14.9176 19.2498 14.5501 18.7298C14.1826 18.2098 13.9901 17.5864 14.0004 16.9497C14.0107 16.313 14.2234 15.6961 14.6076 15.1883C14.9918 14.6806 15.5276 14.3082 16.1375 14.1251C16.7473 13.942 17.3997 13.9577 18 14.17V6H10V19C9.99967 19.6368 9.79673 20.2569 9.42057 20.7707C9.0444 21.2844 8.51451 21.6652 7.90759 21.8578C7.30067 22.0505 6.64819 22.045 6.04459 21.8422C5.44098 21.6394 4.91755 21.2498 4.55006 20.7298C4.18256 20.2098 3.99005 19.5864 4.0004 18.9497C4.01074 18.313 4.2234 17.6961 4.60759 17.1883C4.99179 16.6805 5.52759 16.3082 6.13747 16.1251C6.74735 15.942 7.39966 15.9577 8 16.17V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H18C18.5304 2 19.0391 2.21071 19.4142 2.58579C19.7893 2.96086 20 3.46957 20 4Z"
                fill="#F4F4F4"
              />
            </svg>{" "}
          </span>
          Listen to peaceful sounds before going to sleep. It’ll help you reduce
          stress.
        </div>
      </div>
    </div>
  );
};

export default StatisticsScreen;
